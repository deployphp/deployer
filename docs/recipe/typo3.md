<!-- DO NOT EDIT THIS FILE! -->
<!-- Instead edit recipe/typo3.php -->
<!-- Then run bin/docgen -->

# How to Deploy a TYPO3 Project

```php
require 'recipe/typo3.php';
```

[Source](/recipe/typo3.php)

Deployer is a free and open source deployment tool written in PHP. 
It helps you to deploy your TYPO3 application to a server. 
It is very easy to use and has a lot of features. 

Three main features of Deployer are:
- **Provisioning** - provision your server for you.
- **Zero downtime deployment** - deploy your application without a downtime.
- **Rollbacks** - rollback your application to a previous version, if something goes wrong.

Additionally, Deployer has a lot of other features, like:
- **Easy to use** - Deployer is very easy to use. It has a simple and intuitive syntax.
- **Fast** - Deployer is very fast. It uses parallel connections to deploy your application.
- **Secure** - Deployer uses SSH to connect to your server.
- **Supports all major PHP frameworks** - Deployer supports all major PHP frameworks.

You can read more about Deployer in [Getting Started](/docs/getting-started.md).

The [deploy](#deploy) task of **TYPO3** consists of:
* [deploy:info](/docs/recipe/deploy/info.md#deploy-info) – Displays info about deployment
* [deploy:setup](/docs/recipe/deploy/setup.md#deploy-setup) – Prepares host for deploy
* [deploy:lock](/docs/recipe/deploy/lock.md#deploy-lock) – Locks deploy
* [deploy:release](/docs/recipe/deploy/release.md#deploy-release) – Prepares release
* [typo3:update_code](/docs/recipe/typo3.md#typo3-update_code) – 
* [deploy:shared](/docs/recipe/deploy/shared.md#deploy-shared) – Creates symlinks for shared files and dirs
* [typo3:install:fixfolderstructure](/docs/recipe/typo3.md#typo3-install-fixfolderstructure) – TYPO3 - Fix folder structure
* [deploy:writable](/docs/recipe/deploy/writable.md#deploy-writable) – Makes writable dirs
* [typo3:extension:setup](/docs/recipe/typo3.md#typo3-extension-setup) – TYPO3 - Set up all extensions
* [typo3:language:update](/docs/recipe/typo3.md#typo3-language-update) – TYPO3 - Update the language files of all activated extensions
* [deploy:vendors](/docs/recipe/deploy/vendors.md#deploy-vendors) – Installs vendors
* [typo3:cache:flush](/docs/recipe/typo3.md#typo3-cache-flush) – TYPO3 - Clear all caches
* [typo3:cache:warmup](/docs/recipe/typo3.md#typo3-cache-warmup) – TYPO3 - Cache warmup for system caches
* [deploy:publish](/docs/recipe/common.md#deploy-publish) – Publishes the release
  * [deploy:symlink](/docs/recipe/deploy/symlink.md#deploy-symlink) – Creates symlink to release
  * [deploy:unlock](/docs/recipe/deploy/lock.md#deploy-unlock) – Unlocks deploy
  * [deploy:cleanup](/docs/recipe/deploy/cleanup.md#deploy-cleanup) – Cleanup old releases
  * [deploy:success](/docs/recipe/common.md#deploy-success) – Deploys your project


The typo3 recipe is based on the [common](/docs/recipe/common.md) recipe.


TYPO3 Deployer Recipe

Usage Examples:

Deploy to production (using Git as source):
    vendor/bin/dep deploy production

Deploy to staging using rsync:
    # In deploy.php or servers config, enable rsync
    set('use_rsync', true);
    vendor/bin/dep deploy staging

Common TYPO3 commands:
    vendor/bin/dep typo3:cache:flush                     # Clear all TYPO3 caches
    vendor/bin/dep typo3:cache:warmup                    # Warmup system caches
    vendor/bin/dep typo3:language:update                 # Update extension language files
    vendor/bin/dep typo3:extension:setup                 # Set up all extensions
    vendor/bin/dep typo3:install:fixfolderstructure      # Automatically create required files and folders for TYPO3


## Configuration
### composer_config
[Source](https://github.com/deployphp/deployer/blob/master/recipe/typo3.php#L35)

Parse composer.json and return its contents as an array.
Used for auto-detecting TYPO3 settings like public_dir and bin_dir.

```php title="Default value"
return json_decode(file_get_contents('./composer.json'), true, 512, JSON_THROW_ON_ERROR);
```


### typo3/public_dir
[Source](https://github.com/deployphp/deployer/blob/master/recipe/typo3.php#L44)

TYPO3 public (web) directory.
Automatically determined from composer.json.
Defaults to "public".
:::info Autogenerated
The value of this configuration is autogenerated on access.
:::




### bin/typo3
[Source](https://github.com/deployphp/deployer/blob/master/recipe/typo3.php#L58)

Path to the TYPO3 CLI binary.
Determined from composer.json "config.bin-dir" or defaults to "vendor/bin/typo3".
:::info Autogenerated
The value of this configuration is autogenerated on access.
:::




### log_files
[Source](https://github.com/deployphp/deployer/blob/master/recipe/typo3.php#L71)

Log files to display when running `./vendor/bin/dep logs:app`

```php title="Default value"
'var/log/typo3_*.log'
```


### shared_dirs
[Source](https://github.com/deployphp/deployer/blob/master/recipe/typo3.php#L77)

Overrides [shared_dirs](/docs/recipe/deploy/shared.md#shared_dirs) from `recipe/deploy/shared.php`.

Directories that persist between releases.
Shared via symlinks from the shared/ directory.

```php title="Default value"
[
    '{{typo3/public_dir}}/fileadmin',
    '{{typo3/public_dir}}/typo3temp/assets',
    'var/lock',
    'var/log',
    'var/session',
    'var/spool',
]
```


### writable_dirs
[Source](https://github.com/deployphp/deployer/blob/master/recipe/typo3.php#L99)

Overrides [writable_dirs](/docs/recipe/deploy/writable.md#writable_dirs) from `recipe/deploy/writable.php`.

Writeable directories

```php title="Default value"
[
    '{{typo3/public_dir}}/fileadmin',
    '{{typo3/public_dir}}/typo3temp/assets',
    'var/cache',
    'var/lock',
    'var/log',
]
```


### composer_options
[Source](https://github.com/deployphp/deployer/blob/master/recipe/typo3.php#L110)

Overrides [composer_options](/docs/recipe/deploy/vendors.md#composer_options) from `recipe/deploy/vendors.php`.

Composer install options for production.

```php title="Default value"
' --no-dev --verbose --prefer-dist --no-progress --no-interaction --optimize-autoloader'
```


### use_rsync
[Source](https://github.com/deployphp/deployer/blob/master/recipe/typo3.php#L116)

If set in the config this recipe uses rsync.
Default setting: false (uses the Git repository)

```php title="Default value"
false
```


### update_code_task
[Source](https://github.com/deployphp/deployer/blob/master/recipe/typo3.php#L118)



```php title="Default value"
return get('use_rsync') ? 'rsync' : 'deploy:update_code';
```


### rsync
[Source](https://github.com/deployphp/deployer/blob/master/recipe/typo3.php#L145)



```php title="Default value"
[
    'exclude' => array_merge(get('shared_dirs'), get('shared_files'), $exclude),
    'exclude-file' => false,
    'include' => ['vendor'],
    'include-file' => false,
    'filter' => ['dir-merge,-n /.gitignore'],
    'filter-file' => false,
    'filter-perdir' => false,
    'flags' => 'avz',
    'options' => ['delete', 'keep-dirlinks', 'links'],
    'timeout' => 600,
]
```


### typo3_updateschema_types
[Source](https://github.com/deployphp/deployer/blob/master/recipe/typo3.php#L162)

List of schema update types.
`safe` includes all necessary operations, to add or change fields or tables.

```php title="Default value"
'safe'
```



## Tasks

### typo3\:update_code {#typo3-update_code}
[Source](https://github.com/deployphp/deployer/blob/master/recipe/typo3.php#L122)






### typo3\:cache\:flush {#typo3-cache-flush}
[Source](https://github.com/deployphp/deployer/blob/master/recipe/typo3.php#L171)

TYPO3 - Clear all caches.

TYPO3 Commands
All run via [bin/php](/docs/recipe/common.md#bin/php) [release_path](/docs/recipe/deploy/release.md#release_path)/[bin/typo3](/docs/recipe/typo3.md#bin/typo3) <command>


### typo3\:cache\:warmup {#typo3-cache-warmup}
[Source](https://github.com/deployphp/deployer/blob/master/recipe/typo3.php#L176)

TYPO3 - Cache warmup for system caches.




### typo3\:language\:update {#typo3-language-update}
[Source](https://github.com/deployphp/deployer/blob/master/recipe/typo3.php#L181)

TYPO3 - Update the language files of all activated extensions.




### typo3\:extension\:setup {#typo3-extension-setup}
[Source](https://github.com/deployphp/deployer/blob/master/recipe/typo3.php#L186)

TYPO3 - Set up all extensions.




### typo3\:install\:fixfolderstructure {#typo3-install-fixfolderstructure}
[Source](https://github.com/deployphp/deployer/blob/master/recipe/typo3.php#L191)

TYPO3 - Fix folder structure.




### deploy {#deploy}
[Source](https://github.com/deployphp/deployer/blob/master/recipe/typo3.php#L212)

Deploys a TYPO3 project.

Main deploy task for TYPO3.

1. Lock deploy to avoid concurrent runs
2. Create release directory
3. Update code (Git or rsync)
4. Symlink shared dirs/files
5. Fix TYPO3 folder structure
6. Ensure writable dirs
7. Run extension setup & perform schema updates
8. Update language files
9. Install composer vendors
10. Flush caches
11. Warm up TYPO3 caches
12. Unlock and clean up


This task is group task which contains next tasks:
* [deploy:info](/docs/recipe/deploy/info.md#deploy-info)
* [deploy:setup](/docs/recipe/deploy/setup.md#deploy-setup)
* [deploy:lock](/docs/recipe/deploy/lock.md#deploy-lock)
* [deploy:release](/docs/recipe/deploy/release.md#deploy-release)
* [typo3:update_code](/docs/recipe/typo3.md#typo3-update_code)
* [deploy:shared](/docs/recipe/deploy/shared.md#deploy-shared)
* [typo3:install:fixfolderstructure](/docs/recipe/typo3.md#typo3-install-fixfolderstructure)
* [deploy:writable](/docs/recipe/deploy/writable.md#deploy-writable)
* [typo3:extension:setup](/docs/recipe/typo3.md#typo3-extension-setup)
* [typo3:language:update](/docs/recipe/typo3.md#typo3-language-update)
* [deploy:vendors](/docs/recipe/deploy/vendors.md#deploy-vendors)
* [typo3:cache:flush](/docs/recipe/typo3.md#typo3-cache-flush)
* [typo3:cache:warmup](/docs/recipe/typo3.md#typo3-cache-warmup)
* [deploy:publish](/docs/recipe/common.md#deploy-publish)


